import{i as _e,U as De,A as Ue,p as we,m as Me,q as Q}from"./vendor-BXBPYTiD.js";(function(){try{var n=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new n.Error().stack;e&&(n._sentryDebugIds=n._sentryDebugIds||{},n._sentryDebugIds[e]="9a5e8604-cc09-4649-bc59-5fdd0eac8fb9",n._sentryDebugIdIdentifier="sentry-dbid-9a5e8604-cc09-4649-bc59-5fdd0eac8fb9")}catch{}})();function fe(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function N(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?fe(Object(t),!0).forEach(function(r){F(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):fe(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function Z(n){"@babel/helpers - typeof";return Z=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Z(n)}function se(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function ke(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,ye(r.key),r)}}function ae(n,e,t){return e&&ke(n.prototype,e),Object.defineProperty(n,"prototype",{writable:!1}),n}function F(n,e,t){return e=ye(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Le(n){return qe(n)||Ve(n)||me(n)||xe()}function qe(n){if(Array.isArray(n))return ee(n)}function Ve(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function me(n,e){if(n){if(typeof n=="string")return ee(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ee(n,e)}}function ee(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function xe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ge(n,e){var t=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=me(n))||e){t&&(n=t);var r=0,i=function(){};return{s:i,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,u;return{s:function(){t=t.call(n)},n:function(){var f=t.next();return o=f.done,f},e:function(f){a=!0,u=f},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(a)throw u}}}}function Fe(n,e){if(typeof n!="object"||n===null)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function ye(n){var e=Fe(n,"string");return typeof e=="symbol"?e:String(e)}var l={DEFAULT_INSTANCE:"$default_instance",API_VERSION:2,MAX_STRING_LENGTH:4096,MAX_PROPERTY_KEYS:1e3,IDENTIFY_EVENT:"$identify",GROUP_IDENTIFY_EVENT:"$groupidentify",EVENT_LOG_URL:"api.amplitude.com",EVENT_LOG_EU_URL:"api.eu.amplitude.com",DYNAMIC_CONFIG_URL:"regionconfig.amplitude.com",DYNAMIC_CONFIG_EU_URL:"regionconfig.eu.amplitude.com",LAST_EVENT_ID:"amplitude_lastEventId",LAST_EVENT_TIME:"amplitude_lastEventTime",LAST_IDENTIFY_ID:"amplitude_lastIdentifyId",LAST_SEQUENCE_NUMBER:"amplitude_lastSequenceNumber",SESSION_ID:"amplitude_sessionId",DEVICE_ID:"amplitude_deviceId",OPT_OUT:"amplitude_optOut",USER_ID:"amplitude_userId",DEVICE_ID_INDEX:0,USER_ID_INDEX:1,OPT_OUT_INDEX:2,SESSION_ID_INDEX:3,LAST_EVENT_TIME_INDEX:4,EVENT_ID_INDEX:5,IDENTIFY_ID_INDEX:6,SEQUENCE_NUMBER_INDEX:7,COOKIE_TEST_PREFIX:"amp_cookie_test",COOKIE_PREFIX:"amp",STORAGE_DEFAULT:"",STORAGE_COOKIES:"cookies",STORAGE_NONE:"none",STORAGE_LOCAL:"localStorage",STORAGE_SESSION:"sessionStorage",REVENUE_EVENT:"revenue_amount",REVENUE_PRODUCT_ID:"$productId",REVENUE_QUANTITY:"$quantity",REVENUE_PRICE:"$price",REVENUE_REVENUE_TYPE:"$revenueType",AMP_DEVICE_ID_PARAM:"amp_device_id",AMP_REFERRER_PARAM:"amp_referrer",REFERRER:"referrer",REFERRING_DOMAIN:"referring_domain",UTM_SOURCE:"utm_source",UTM_MEDIUM:"utm_medium",UTM_CAMPAIGN:"utm_campaign",UTM_TERM:"utm_term",UTM_CONTENT:"utm_content",ATTRIBUTION_EVENT:"[Amplitude] Attribution Captured",TRANSPORT_HTTP:"http",TRANSPORT_BEACON:"beacon"},pe={encode:function(e){for(var t="",r=0;r<e.length;r++){var i=e.charCodeAt(r);i<128?t+=String.fromCharCode(i):i>127&&i<2048?(t+=String.fromCharCode(i>>6|192),t+=String.fromCharCode(i&63|128)):(t+=String.fromCharCode(i>>12|224),t+=String.fromCharCode(i>>6&63|128),t+=String.fromCharCode(i&63|128))}return t},decode:function(e){for(var t="",r=0,i=0,o=0,a=0;r<e.length;)i=e.charCodeAt(r),i<128?(t+=String.fromCharCode(i),r++):i>191&&i<224?(o=e.charCodeAt(r+1),t+=String.fromCharCode((i&31)<<6|o&63),r+=2):(o=e.charCodeAt(r+1),a=e.charCodeAt(r+2),t+=String.fromCharCode((i&15)<<12|(o&63)<<6|a&63),r+=3);return t}},v=function(){if(typeof globalThis<"u")return globalThis;if(typeof window<"u")return window;if(typeof self<"u")return self;if(typeof globalThis<"u")return globalThis}(),R={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){try{if(v.btoa&&v.atob)return v.btoa(unescape(encodeURIComponent(e)))}catch{}return R._encode(e)},_encode:function(e){var t="",r,i,o,a,u,f,p,h=0;for(e=pe.encode(e);h<e.length;)r=e.charCodeAt(h++),i=e.charCodeAt(h++),o=e.charCodeAt(h++),a=r>>2,u=(r&3)<<4|i>>4,f=(i&15)<<2|o>>6,p=o&63,isNaN(i)?f=p=64:isNaN(o)&&(p=64),t=t+R._keyStr.charAt(a)+R._keyStr.charAt(u)+R._keyStr.charAt(f)+R._keyStr.charAt(p);return t},decode:function(e){try{if(v.btoa&&v.atob)return decodeURIComponent(escape(v.atob(e)))}catch{}return R._decode(e)},_decode:function(e){var t="",r,i,o,a,u,f,p,h=0;for(e=e.replace(/[^A-Za-z0-9+/=]/g,"");h<e.length;)a=R._keyStr.indexOf(e.charAt(h++)),u=R._keyStr.indexOf(e.charAt(h++)),f=R._keyStr.indexOf(e.charAt(h++)),p=R._keyStr.indexOf(e.charAt(h++)),r=a<<2|u>>4,i=(u&15)<<4|f>>2,o=(f&3)<<6|p,t=t+String.fromCharCode(r),f!==64&&(t=t+String.fromCharCode(i)),p!==64&&(t=t+String.fromCharCode(o));return t=pe.decode(t),t}},je=Object.prototype.toString;function d(n){switch(je.call(n)){case"[object Date]":return"date";case"[object RegExp]":return"regexp";case"[object Arguments]":return"arguments";case"[object Array]":return"array";case"[object Error]":return"error"}return n===null?"null":n===void 0?"undefined":n!==n?"nan":n&&n.nodeType===1?"element":typeof Buffer<"u"&&typeof Buffer.isBuffer=="function"&&Buffer.isBuffer(n)?"buffer":(n=n.valueOf?n.valueOf():Object.prototype.valueOf.apply(n),Z(n))}var V={DISABLE:0,ERROR:1,WARN:2,INFO:3},K=V.WARN,Ke=function(e){Object.prototype.hasOwnProperty.call(V,e)&&(K=V[e])},We=function(){return K},O={error:function(e){K>=V.ERROR&&z(e)},warn:function(e){K>=V.WARN&&z(e)},info:function(e){K>=V.INFO&&z(e)}},z=function(e){try{console.log("[Amplitude] "+e)}catch{}},Be=function(e){return!e||e.length===0},Xe=function(){try{if(v.sessionStorage)return!0}catch{}return!1},He=function n(e){if(d(e)==="array")for(var t=0;t<e.length;t++)e[t]=n(e[t]);else if(d(e)==="object")for(var r in e)r in e&&(e[r]=n(e[r]));else e=Ye(e);return e},Ye=function(e){return d(e)==="string"&&e.length>l.MAX_STRING_LENGTH?e.substring(0,l.MAX_STRING_LENGTH):e},Y=function(e,t,r){return d(e)!==r?(O.error("Invalid "+t+" input type. Expected "+r+" but received "+d(e)),!1):!0},$e=function(e){return Y(e,"deviceId","string")?e.indexOf(".")>=0?(O.error(`Device IDs may not contain '.' characters. Value will be ignored: "`.concat(e,'"')),!1):!0:!1},Qe=function(e){return Y(e,"transport","string")?e!==l.TRANSPORT_HTTP&&e!==l.TRANSPORT_BEACON?(O.error("transport value must be one of '".concat(l.TRANSPORT_BEACON,"' or '").concat(l.TRANSPORT_HTTP,"'")),!1):e!==l.TRANSPORT_HTTP&&typeof navigator<"u"&&!navigator.sendBeacon?(O.error("browser does not support sendBeacon, so transport must be HTTP"),!1):!0:!1},te=function(e){var t=d(e);if(t!=="object")return O.error("Error: invalid properties format. Expecting Javascript object, received "+t+", ignoring"),{};if(Object.keys(e).length>l.MAX_PROPERTY_KEYS)return O.error("Error: too many properties (more than 1000), ignoring"),{};var r={};for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var o=i,a=d(o);a!=="string"&&(o=String(o),O.warn("WARNING: Non-string property key, received type "+a+', coercing to string "'+o+'"'));var u=Je(o,e[i]);u!==null&&(r[o]=u)}return r},ze=["nan","function","arguments","regexp","element"],Je=function n(e,t){var r=d(t);if(ze.indexOf(r)!==-1)O.warn('WARNING: Property key "'+e+'" with invalid value type '+r+", ignoring"),t=null;else if(r==="undefined")t=null;else if(r==="error")t=String(t),O.warn('WARNING: Property key "'+e+'" with value type error, coercing to '+t);else if(r==="array"){for(var i=[],o=0;o<t.length;o++){var a=t[o],u=d(a);if(u==="array"){O.warn("WARNING: Cannot have "+u+" nested in an array property value, skipping");continue}else u==="object"?i.push(te(a)):i.push(n(e,a))}t=i}else r==="object"&&(t=te(t));return t},Ze=function(e){var t=d(e);if(t!=="object")return O.error("Error: invalid groups format. Expecting Javascript object, received "+t+", ignoring"),{};var r={};for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var o=i,a=d(o);a!=="string"&&(o=String(o),O.warn("WARNING: Non-string groupType, received type "+a+', coercing to string "'+o+'"'));var u=et(o,e[i]);u!==null&&(r[o]=u)}return r},et=function(e,t){var r=d(t);if(r==="string")return t;if(r==="date"||r==="number"||r==="boolean")return t=String(t),O.warn("WARNING: Non-string groupName, received type "+r+', coercing to string "'+t+'"'),t;if(r==="array"){for(var i=[],o=0;o<t.length;o++){var a=t[o],u=d(a);if(u==="array"||u==="object"){O.warn("WARNING: Skipping nested "+u+" in array groupName");continue}else u==="string"?i.push(a):(u==="date"||u==="number"||u==="boolean")&&(a=String(a),O.warn("WARNING: Non-string groupName, received type "+u+', coercing to string "'+a+'"'),i.push(a))}return i}O.warn("WARNING: Non-string groupName, received type "+r+". Please use strings or array of strings for groupName")},tt=function(e,t){e=e.replace(/[[]/,"\\[").replace(/[\]]/,"\\]");var r=new RegExp("[\\?&]"+e+"=([^&#]*)"),i=r.exec(t);return i===null?void 0:decodeURIComponent(i[1].replace(/\+/g," "))},nt=function(){return typeof WorkerGlobalScope<"u"},rt=function(e){return Y(e,"sessionId","number")&&new Date(e).getTime()>0?!0:(O.error("sessionId value must in milliseconds since epoch (Unix Timestamp)"),!1)},it=function(){return v.location},ot=function(e){var t=v.location?v.location.hostname:"";if(e){if(typeof document<"u"){var r=document.createElement("a");return r.href=e,r.hostname||t}if(typeof URL=="function"){var i=new URL(e);return i.hostname||t}}return t},s={setLogLevel:Ke,getLogLevel:We,logLevels:V,log:O,isEmptyString:Be,isWebWorkerEnvironment:nt,getQueryParam:tt,sessionStorageEnabled:Xe,truncate:He,validateGroups:Ze,validateInput:Y,validateProperties:te,validateDeviceId:$e,validateTransport:Qe,validateSessionId:rt,getLocation:it,getHost:ot},Ee=function(e){try{for(var t=document.cookie.split(";"),r=null,i=0;i<t.length;i++){for(var o=t[i];o.charAt(0)===" ";)o=o.substring(1,o.length);if(o.indexOf(e)===0){r=o.substring(e.length,o.length);break}}return r}catch{return null}},st=function(e){try{var t=document.cookie.split(";").map(function(u){return u.trimStart()}),r=[],i=Ge(t),o;try{for(i.s();!(o=i.n()).done;){for(var a=o.value;a.charAt(0)===" ";)a=a.substring(1);a.indexOf(e)===0&&r.push(a.substring(e.length))}}catch(u){i.e(u)}finally{i.f()}return r}catch{return[]}},ne=function(e,t,r){var i=t!==null?r.expirationDays:-1;if(i){var o=new Date;o.setTime(o.getTime()+i*24*60*60*1e3),i=o}var a=e+"="+t;i&&(a+="; expires="+i.toUTCString()),a+="; path=/",r.domain&&(a+="; domain="+r.domain),r.secure&&(a+="; Secure"),r.sameSite&&(a+="; SameSite="+r.sameSite),document.cookie=a},re=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",t=e.split(".")[l.LAST_EVENT_TIME_INDEX],r;return t&&(r=parseInt(t,32)),r||(s.log.warn("unable to parse malformed cookie: ".concat(e)),0)},at=function(e){return Le(e).sort(function(t,r){var i=re(t),o=re(r);return o-i})},ut=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=l.COOKIE_TEST_PREFIX;if(typeof document>"u")return!1;var r=!1;try{var i=String(Date.now());ne(t,i,e),s.log.info("Testing if cookies available"),r=Ee(t+"=")===i}catch(o){s.log.warn('Error thrown when checking for cookies. Reason: "'.concat(o,'"'))}finally{s.log.info("Cleaning up cookies availability test"),ne(t,null,e)}return r},I={set:ne,get:Ee,getAll:st,getLastEventTime:re,sortByEventTime:at,areCookiesEnabled:ut},lt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",ue=function(){for(var e="",t=0;t<22;++t)e+=lt.charAt(Math.floor(Math.random()*64));return e},Ie=function(e){var t=s.getHost(e),r=t.split("."),i=[],o="_tldtest_"+ue();if(s.isWebWorkerEnvironment())return"";for(var a=r.length-2;a>=0;--a)i.push(r.slice(a).join("."));for(var u=0;u<i.length;++u){var f=i[u],p={domain:"."+f};if(I.set(o,1,p),I.get(o))return I.set(o,null,p),f}return""},b={expirationDays:void 0,domain:void 0},ct=function(){b={expirationDays:void 0,domain:void 0}},ft=function(e){if(arguments.length===0)return b;e=e||{},b.expirationDays=e.expirationDays,b.secure=e.secure,b.sameSite=e.sameSite;var t=s.isEmptyString(e.domain)?"."+Ie(s.getLocation().href):e.domain,r=Math.random();b.domain=t,Oe("amplitude_test",r);var i=Se("amplitude_test");return(!i||i!==r)&&(t=null),Ne("amplitude_test"),b.domain=t,b},W=function(e){var t="";return b.domain&&(t=b.domain.charAt(0)==="."?b.domain.substring(1):b.domain),e+t},Se=function(e){var t=W(e)+"=",r=I.get(t);try{if(r)return JSON.parse(R.decode(r))}catch{return null}return null},Oe=function(e,t){try{return I.set(W(e),R.encode(JSON.stringify(t)),b),!0}catch{return!1}},pt=function(e,t){try{return I.set(W(e),t,b),!0}catch{return!1}},dt=function(e){var t=W(e)+"=";return I.get(t)},Ne=function(e){try{return I.set(W(e),null,b),!0}catch{return!1}},ht={reset:ct,options:ft,get:Se,set:Oe,remove:Ne,setRaw:pt,getRaw:dt},vt=function(){function n(){se(this,n),this.map=new Map,this.length=0}return ae(n,[{key:"key",value:function(t){var r=Array.from(this.map.keys()),i=r[t];return this.map.get(i)}},{key:"getItem",value:function(t){return this.map.get(t)}},{key:"setItem",value:function(t,r){this.map.has(t)||(this.length+=1),this.map.set(t,r)}},{key:"removeItem",value:function(t){this.map.has(t)&&(this.length-=1,this.map.delete(t))}},{key:"clear",value:function(){this.map.clear(),this.length=0}}]),n}(),k;{var gt=function(){var e=new Date,t;try{return v.localStorage.setItem(e,e),t=v.localStorage.getItem(e)===String(e),v.localStorage.removeItem(e),t}catch{}return!1};if(gt())k=v.localStorage;else if(typeof v<"u"&&v.globalStorage)try{k=v.globalStorage[v.location.hostname]}catch{}else if(typeof document<"u"){var y=document.createElement("div"),D="localStorage";y.style.display="none",document.getElementsByTagName("head")[0].appendChild(y),y.addBehavior&&(y.addBehavior("#default#userdata"),k={length:0,setItem:function(e,t){y.load(D),y.getAttribute(e)||this.length++,y.setAttribute(e,t),y.save(D)},getItem:function(e){return y.load(D),y.getAttribute(e)},removeItem:function(e){y.load(D),y.getAttribute(e)&&this.length--,y.removeAttribute(e),y.save(D)},clear:function(){y.load(D);for(var e=0,t;t=y.XMLDocument.documentElement.attributes[e++];)y.removeAttribute(t.name);y.save(D),this.length=0},key:function(e){return y.load(D),y.XMLDocument.documentElement.attributes[e]}},y.load(D),k.length=y.XMLDocument.documentElement.attributes.length)}else s.isWebWorkerEnvironment()&&(k=new vt);k||(k={length:0,setItem:function(e,t){},getItem:function(e){},removeItem:function(e){},clear:function(){},key:function(e){}})}var P=k,Te=function(){this.storage=null};Te.prototype.getStorage=function(n){if(this.storage!==null)return this.storage;if(!n&&I.areCookiesEnabled())this.storage=ht;else{var e="amp_cookiestore_";this.storage={_options:{expirationDays:void 0,domain:void 0,secure:!1},reset:function(){this._options={expirationDays:void 0,domain:void 0,secure:!1}},options:function(r){return arguments.length===0?this._options:(r=r||{},this._options.expirationDays=r.expirationDays||this._options.expirationDays,this._options.domain=r.domain||this._options.domain||v&&v.location&&v.location.hostname,this._options.secure=r.secure||!1)},get:function(r){try{return JSON.parse(P.getItem(e+r))}catch{}return null},set:function(r,i){try{return P.setItem(e+r,JSON.stringify(i)),!0}catch{}return!1},remove:function(r){try{P.removeItem(e+r)}catch{return!1}}}}return this.storage};var G,_t=(G={},F(G,l.STORAGE_COOKIES,!0),F(G,l.STORAGE_NONE,!0),F(G,l.STORAGE_LOCAL,!0),F(G,l.STORAGE_SESSION,!0),G),mt=function(){function n(e){var t=e.storageKey,r=e.disableCookies,i=e.domain,o=e.secure,a=e.sameSite,u=e.expirationDays,f=e.storage;se(this,n),this.storageKey=t,this.domain=i,this.secure=o,this.sameSite=a,this.expirationDays=u,this.cookieDomain="";var p=s.getLocation()?s.getLocation().href:void 0,h=r?"":Ie(p);if(this.cookieDomain=i||(h?"."+h:null),_t[f])this.storage=f;else{var g=r||!I.areCookiesEnabled({domain:this.cookieDomain,secure:this.secure,sameSite:this.sameSite,expirationDays:this.expirationDays});g?this.storage=l.STORAGE_LOCAL:this.storage=l.STORAGE_COOKIES}}return ae(n,[{key:"getCookieStorageKey",value:function(){if(!this.domain)return this.storageKey;var t=this.domain.charAt(0)==="."?this.domain.substring(1):this.domain;return"".concat(this.storageKey).concat(t?"_".concat(t):"")}},{key:"save",value:function(t){var r=t.deviceId,i=t.userId,o=t.optOut,a=t.sessionId,u=t.lastEventTime,f=t.eventId,p=t.identifyId,h=t.sequenceNumber;if(this.storage!==l.STORAGE_NONE){var g=[r,R.encode(i||""),o?"1":"",a?a.toString(32):"0",u?u.toString(32):"0",f?f.toString(32):"0",p?p.toString(32):"0",h?h.toString(32):"0"].join(".");switch(this.storage){case l.STORAGE_SESSION:v.sessionStorage&&v.sessionStorage.setItem(this.storageKey,g);break;case l.STORAGE_LOCAL:P.setItem(this.storageKey,g);break;case l.STORAGE_COOKIES:this.saveCookie(g);break}}}},{key:"saveCookie",value:function(t){I.set(this.getCookieStorageKey(),t,{domain:this.cookieDomain,secure:this.secure,sameSite:this.sameSite,expirationDays:this.expirationDays})}},{key:"load",value:function(){var t=this,r;if(this.storage===l.STORAGE_COOKIES){var i=this.getCookieStorageKey()+"=",o=I.getAll(i);if(o.length===0||o.length===1)r=o[0];else{var a=I.sortByEventTime(o)[0];o.forEach(function(){return I.set(t.getCookieStorageKey(),null,{})}),this.saveCookie(a),r=I.get(i)}}if(r||(r=P.getItem(this.storageKey)),!r)try{r=v.sessionStorage&&v.sessionStorage.getItem(this.storageKey)}catch(p){s.log.info('window.sessionStorage unavailable. Reason: "'.concat(p,'"'))}if(!r)return null;var u=r.split("."),f=null;if(u[l.USER_ID_INDEX])try{f=R.decode(u[l.USER_ID_INDEX])}catch{f=null}return{deviceId:u[l.DEVICE_ID_INDEX],userId:f,optOut:u[l.OPT_OUT_INDEX]==="1",sessionId:parseInt(u[l.SESSION_ID_INDEX],32),lastEventTime:parseInt(u[l.LAST_EVENT_TIME_INDEX],32),eventId:parseInt(u[l.EVENT_ID_INDEX],32),identifyId:parseInt(u[l.IDENTIFY_ID_INDEX],32),sequenceNumber:parseInt(u[l.SEQUENCE_NUMBER_INDEX],32)}}},{key:"clear",value:function(){var t;if(this.storage===l.STORAGE_COOKIES&&(t=I.get(this.getCookieStorageKey()+"="),I.set(this.getCookieStorageKey(),null,{domain:this.cookieDomain,secure:this.secure,sameSite:this.sameSite,expirationDays:0})),t||(t=P.getItem(this.storageKey),P.clear()),!t)try{t=v.sessionStorage&&v.sessionStorage.getItem(this.storageKey),v.sessionStorage.clear()}catch(r){s.log.info('window.sessionStorage unavailable. Reason: "'.concat(r,'"'))}return!!t}}]),n}(),yt=function(e,t){var r=e?"?"+e.split(".").slice(-1)[0].replace(/\|/g,"&"):"",i=function(T,_,A,M){return s.getQueryParam(T,_)||s.getQueryParam(A,M)},o=i(l.UTM_SOURCE,t,"utmcsr",r),a=i(l.UTM_MEDIUM,t,"utmcmd",r),u=i(l.UTM_CAMPAIGN,t,"utmccn",r),f=i(l.UTM_TERM,t,"utmctr",r),p=i(l.UTM_CONTENT,t,"utmcct",r),h={},g=function(T,_){s.isEmptyString(_)||(h[T]=_)};return g(l.UTM_SOURCE,o),g(l.UTM_MEDIUM,a),g(l.UTM_CAMPAIGN,u),g(l.UTM_TERM,f),g(l.UTM_CONTENT,p),h},Et="$add",It="$append",ie="$clearAll",St="$prepend",Ot="$set",Nt="$setOnce",Tt="$unset",bt="$preInsert",Rt="$postInsert",At="$remove",E=function(){this.userPropertiesOperations={},this.properties=[]};E.prototype.add=function(n,e){return d(e)==="number"||d(e)==="string"?this._addOperation(Et,n,e):s.log.error("Unsupported type for value: "+d(e)+", expecting number or string"),this};E.prototype.append=function(n,e){return this._addOperation(It,n,e),this};E.prototype.clearAll=function(){return Object.keys(this.userPropertiesOperations).length>0?(Object.prototype.hasOwnProperty.call(this.userPropertiesOperations,ie)||s.log.error("Need to send $clearAll on its own Identify object without any other operations, skipping $clearAll"),this):(this.userPropertiesOperations[ie]="-",this)};E.prototype.prepend=function(n,e){return this._addOperation(St,n,e),this};E.prototype.set=function(n,e){return this._addOperation(Ot,n,e),this};E.prototype.setOnce=function(n,e){return this._addOperation(Nt,n,e),this};E.prototype.unset=function(n){return this._addOperation(Tt,n,"-"),this};E.prototype.preInsert=function(n,e){return this._addOperation(bt,n,e),this};E.prototype.postInsert=function(n,e){return this._addOperation(Rt,n,e),this};E.prototype.remove=function(n,e){return this._addOperation(At,n,e),this};E.prototype._addOperation=function(n,e,t){if(Object.prototype.hasOwnProperty.call(this.userPropertiesOperations,ie)){s.log.error("This identify already contains a $clearAll operation, skipping operation "+n);return}if(this.properties.indexOf(e)!==-1){s.log.error('User property "'+e+'" already used in this identify, skipping operation '+n);return}Object.prototype.hasOwnProperty.call(this.userPropertiesOperations,n)||(this.userPropertiesOperations[n]={}),this.userPropertiesOperations[n][e]=t,this.properties.push(e)};var be=function(e,t,r){this.url=e,this.data=t||{},this.headers=r},Pt="Cross-Origin-Resource-Policy";function Ct(n,e){for(var t in e)t===Pt&&!e[t]||n.setRequestHeader(t,e[t])}be.prototype.send=function(n){var e=!!v.XDomainRequest;if(e){var t=new v.XDomainRequest;t.open("POST",this.url,!0),t.onload=function(){n(200,t.responseText)},t.onerror=function(){t.responseText==="Request Entity Too Large"?n(413,t.responseText):n(500,t.responseText)},t.ontimeout=function(){},t.onprogress=function(){},t.send(Q.stringify(this.data))}else if(typeof XMLHttpRequest<"u"){var r=new XMLHttpRequest;r.open("POST",this.url,!0),r.onreadystatechange=function(){r.readyState===4&&n(r.status,r.responseText)},Ct(r,this.headers),r.send(Q.stringify(this.data))}else{var i=void 0;fetch(this.url,{method:"POST",headers:this.headers,body:Q.stringify(this.data)}).then(function(o){return i=o.status,o.text()}).then(function(o){n(i,o)})}};var C=function(){this._price=null,this._productId=null,this._quantity=1,this._revenueType=null,this._properties=null};C.prototype.setProductId=function(e){return d(e)!=="string"?s.log.error("Unsupported type for productId: "+d(e)+", expecting string"):s.isEmptyString(e)?s.log.error("Invalid empty productId"):this._productId=e,this};C.prototype.setQuantity=function(e){return d(e)!=="number"?s.log.error("Unsupported type for quantity: "+d(e)+", expecting number"):this._quantity=parseInt(e),this};C.prototype.setPrice=function(e){return d(e)!=="number"?s.log.error("Unsupported type for price: "+d(e)+", expecting number"):this._price=e,this};C.prototype.setRevenueType=function(e){return d(e)!=="string"?s.log.error("Unsupported type for revenueType: "+d(e)+", expecting string"):this._revenueType=e,this};C.prototype.setEventProperties=function(e){return d(e)!=="object"?s.log.error("Unsupported type for eventProperties: "+d(e)+", expecting object"):this._properties=s.validateProperties(e),this};C.prototype._isValidRevenue=function(){return d(this._price)!=="number"?(s.log.error("Invalid revenue, need to set price field"),!1):!0};C.prototype._toJSONObject=function(){var e=d(this._properties)==="object"?this._properties:{};return this._productId!==null&&(e[l.REVENUE_PRODUCT_ID]=this._productId),this._quantity!==null&&(e[l.REVENUE_QUANTITY]=this._quantity),this._price!==null&&(e[l.REVENUE_PRICE]=this._price),this._revenueType!==null&&(e[l.REVENUE_REVENUE_TYPE]=this._revenueType),e};var Dt=function n(e){return e?(e^Math.random()*16>>e/4).toString(16):("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,n)},Ut=function(){return typeof navigator<"u"&&(navigator.languages&&navigator.languages[0]||navigator.language||navigator.userLanguage)||""},wt={getLanguage:Ut},x={US:"US",EU:"EU"},Re=function(e){var t=l.EVENT_LOG_URL;switch(e){case x.EU:t=l.EVENT_LOG_EU_URL;break;case x.US:t=l.EVENT_LOG_URL;break}return t},Mt=function(e){var t=l.DYNAMIC_CONFIG_URL;switch(e){case x.EU:t=l.DYNAMIC_CONFIG_EU_URL;break;case x.US:t=l.DYNAMIC_CONFIG_URL;break}return t},Ae="8.21.9",L={apiEndpoint:l.EVENT_LOG_URL,batchEvents:!1,cookieExpiration:365,cookieName:"amplitude_id",sameSiteCookie:"Lax",cookieForceUpgrade:!1,deferInitialization:!1,disableCookies:!1,deviceIdFromUrlParam:!1,domain:"",eventUploadPeriodMillis:30*1e3,eventUploadThreshold:30,forceHttps:!0,includeFbclid:!1,includeGclid:!1,includeReferrer:!1,includeUtm:!1,ingestionMetadata:{sourceName:"",sourceVersion:""},language:wt.getLanguage(),library:{name:"amplitude-js",version:Ae},logLevel:"WARN",logAttributionCapturedEvent:!1,optOut:!1,onError:function(){},onExitPage:function(){},onNewSessionStart:function(){},plan:{branch:"",source:"",version:"",versionId:""},platform:"Web",savedMaxCount:1e3,saveEvents:!0,saveParamsReferrerOncePerSession:!0,secureCookie:!1,sessionTimeout:30*60*1e3,storage:l.STORAGE_DEFAULT,trackingOptions:{city:!0,country:!0,carrier:!0,device_manufacturer:!0,device_model:!0,dma:!0,ip_address:!0,language:!0,os_name:!0,os_version:!0,platform:!0,region:!0,version_name:!0},transport:l.TRANSPORT_HTTP,unsetParamsReferrerOnNewSession:!1,unsentKey:"amplitude_unsent",unsentIdentifyKey:"amplitude_unsent_identify",uploadBatchSize:100,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8","Cross-Origin-Resource-Policy":"cross-origin"},serverZone:x.US,useDynamicConfig:!1,serverZoneBasedApi:!1,sessionId:null,partnerId:""},kt=function(){function n(){return se(this,n),n.instance||(this.ingestionEndpoint=l.EVENT_LOG_URL,n.instance=this),n.instance}return ae(n,[{key:"refresh",value:function(t,r,i){var o="https";!r&&v.location.protocol!=="https:"&&(o="http");var a=o+"://"+Mt(t),u=this,f=!!v.XDomainRequest;if(f){var p=new v.XDomainRequest;p.open("GET",a,!0),p.onload=function(){var g=JSON.parse(p.responseText);u.ingestionEndpoint=g.ingestionEndpoint,i&&i()},p.onerror=function(){},p.ontimeout=function(){},p.onprogress=function(){},p.send()}else{var h=new XMLHttpRequest;h.open("GET",a,!0),h.onreadystatechange=function(){if(h.readyState===4&&h.status===200){var g=JSON.parse(h.responseText);u.ingestionEndpoint=g.ingestionEndpoint,i&&i()}},h.send()}}}]),n}(),de=new kt,c=function(e){!_e()&&!s.isWebWorkerEnvironment()&&s.log.warn("amplitude-js will not work in a non-browser environment. If you are planning to add Amplitude to a node environment, please use @amplitude/node"),this._instanceName=s.isEmptyString(e)?l.DEFAULT_INSTANCE:e.toLowerCase(),this._unsentEvents=[],this._unsentIdentifys=[],this.options=N(N({},L),{},{headers:N({},L.headers),ingestionMetadata:N({},L.ingestionMetadata),library:N({},L.library),plan:N({},L.plan),trackingOptions:N({},L.trackingOptions)}),this._q=[],this._sending=!1,this._updateScheduled=!1,this._onInitCallbacks=[],this._onNewSessionStartCallbacks=[],this._eventId=0,this._identifyId=0,this._lastEventTime=null,this._newSession=!1,this._sequenceNumber=0,this._sessionId=null,this._isInitialized=!1,this._connector=null,this._userAgent=typeof navigator<"u"&&navigator&&navigator.userAgent||null,this._ua=new De(this._userAgent).getResult()};c.prototype.Identify=E;c.prototype.Revenue=C;c.prototype.init=function(e,t,r,i){var o=this;if(d(e)!=="string"||s.isEmptyString(e)){s.log.error("Invalid apiKey. Please re-initialize with a valid apiKey");return}try{this._connector=Ue.getInstance(this._instanceName),Lt(this.options,r),(_e()||s.isWebWorkerEnvironment())&&v.Prototype!==void 0&&Array.prototype.toJSON&&(we(),s.log.warn("Prototype.js injected Array.prototype.toJSON. Deleting Array.prototype.toJSON to prevent double-stringify")),this.options.cookieName!==L.cookieName&&s.log.warn("The cookieName option is deprecated. We will be ignoring it for newer cookies"),this.options.serverZoneBasedApi&&(this.options.apiEndpoint=Re(this.options.serverZone)),this._refreshDynamicConfig(),this.options.apiKey=e,this._storageSuffix="_"+e+(this._instanceName===l.DEFAULT_INSTANCE?"":"_"+this._instanceName),this._storageSuffixV5=e.slice(0,6),this._oldCookiename=this.options.cookieName+this._storageSuffix,this._unsentKey=this.options.unsentKey+this._storageSuffix,this._unsentIdentifyKey=this.options.unsentIdentifyKey+this._storageSuffix,this._cookieName=l.COOKIE_PREFIX+"_"+this._storageSuffixV5,this.cookieStorage=new Te().getStorage(this.options.disableCookies),this.cookieStorage.options({expirationDays:this.options.cookieExpiration,domain:this.options.domain,secure:this.options.secureCookie,sameSite:this.options.sameSiteCookie}),this._metadataStorage=new mt({storageKey:this._cookieName,disableCookies:this.options.disableCookies,expirationDays:this.options.cookieExpiration,domain:this.options.domain,secure:this.options.secureCookie,sameSite:this.options.sameSiteCookie,storage:this.options.storage});var a=!!this.cookieStorage.get(this._oldCookiename),u=!!this._metadataStorage.load();this._useOldCookie=!u&&a&&!this.options.cookieForceUpgrade;var f=u||a;if(this.options.deferInitialization&&!f){this._deferInitialization(e,t,r,i);return}this.options.domain=this.cookieStorage.options().domain,d(this.options.logLevel)==="string"&&s.setLogLevel(this.options.logLevel);var p=Gt(this);this._apiPropertiesTrackingOptions=Object.keys(p).length>0?{tracking_options:p}:{},this.options.cookieForceUpgrade&&a&&(u||qt(this),this.cookieStorage.remove(this._oldCookiename)),le(this),this._pendingReadStorage=!0;var h=function(A){r&&r.deviceId&&!s.validateDeviceId(r.deviceId)&&(s.log.error('Invalid device ID rejected. Randomly generated UUID will be used instead of "'.concat(r.deviceId,'"')),delete r.deviceId),o.options.deviceId=o._getInitialDeviceId(r&&r.deviceId,A),o.options.userId=d(t)==="string"&&!s.isEmptyString(t)&&t||d(t)==="number"&&t.toString()||o.options.userId||null;var M=new Date().getTime(),B=!o._sessionId||!o._lastEventTime||M-o._lastEventTime>o.options.sessionTimeout||o.options.sessionId;B&&(o.options.unsetParamsReferrerOnNewSession&&o._unsetUTMParams(),o._newSession=!0,o._sessionId=o.options.sessionId||M,o.options.sessionId=void 0,o.options.saveParamsReferrerOncePerSession&&o._trackParamsAndReferrer()),o.options.saveParamsReferrerOncePerSession||o._trackParamsAndReferrer(),o.options.saveEvents&&(he(o._unsentEvents),he(o._unsentIdentifys)),o._lastEventTime=M,U(o),o._pendingReadStorage=!1,o._sendEventsIfReady();for(var j=0;j<o._onInitCallbacks.length;j++)o._onInitCallbacks[j](o);o._onInitCallbacks=[],o._isInitialized=!0,B&&o._runNewSessionStartCallbacks()};this.options.saveEvents&&(this._unsentEvents=this._loadSavedUnsentEvents(this.options.unsentKey).map(function(_){return{event:_}}).concat(this._unsentEvents),this._unsentIdentifys=this._loadSavedUnsentEvents(this.options.unsentIdentifyKey).map(function(_){return{event:_}}).concat(this._unsentIdentifys)),r&&r.onNewSessionStart&&this.onNewSessionStart(this.options.onNewSessionStart),h(),this.runQueuedFunctions(),d(i)==="function"&&i(this);var g=this.options.onExitPage;if(d(g)==="function"&&v.addEventListener&&!this.pageHandlersAdded){this.pageHandlersAdded=!0;var w=function(){var A=o.options.transport;o.setTransport(l.TRANSPORT_BEACON),g(),o.setTransport(A)};v.addEventListener("pagehide",function(){w()},!1)}this._connector.eventBridge.setEventReceiver(function(_){o._logEvent(_.eventType,_.eventProperties,_.userProperties)});var T=this._connector.identityStore.editIdentity();this.options.deviceId&&T.setDeviceId(this.options.deviceId),this.options.userId&&T.setUserId(this.options.userId),T.commit()}catch(_){s.log.error(_),r&&d(r.onError)==="function"&&r.onError(_)}};c.prototype._runNewSessionStartCallbacks=function(){for(var n=0;n<this._onNewSessionStartCallbacks.length;n++)this._onNewSessionStartCallbacks[n](this)};c.prototype.deleteLowerLevelDomainCookies=function(){var n=s.getHost(),e=this.options.domain&&this.options.domain[0]==="."?this.options.domain.slice(1):this.options.domain;if(!(!e||!s.isWebWorkerEnvironment())&&n!==e&&new RegExp(e+"$").test(n)){for(var t=n.split("."),r=e.split("."),i=t.length;i>r.length;--i){var o=t.slice(t.length-i).join(".");I.set(this._cookieName,null,{domain:"."+o})}I.set(this._cookieName,null,{})}};c.prototype._getInitialDeviceId=function(n,e){if(n)return n;if(this.options.deviceIdFromUrlParam){var t=this._getDeviceIdFromUrlParam(this._getUrlParams());if(t)return t}return this.options.deviceId?this.options.deviceId:e||ue()};var he=function(e){for(var t=0;t<e.length;t++){var r=e[t].event.user_properties,i=e[t].event.event_properties,o=e[t].event.groups;e[t].event.user_properties=s.validateProperties(r),e[t].event.event_properties=s.validateProperties(i),e[t].event.groups=s.validateGroups(o)}};c.prototype._trackParamsAndReferrer=function(){var e,t,r,i;if(this.options.includeUtm&&(e=this._initUtmData()),this.options.includeReferrer&&(t=this._saveReferrer(this._getReferrer())),this.options.includeGclid&&(r=this._saveGclid(this._getUrlParams())),this.options.includeFbclid&&(i=this._saveFbclid(this._getUrlParams())),this.options.logAttributionCapturedEvent){var o=N(N(N(N({},e),t),r),i);Object.keys(o).length>0&&this.logEvent(l.ATTRIBUTION_EVENT,o)}};var Lt=function n(e,t){if(d(t)==="object"){var r=new Set(["headers"]),i=new Set(["eventUploadPeriodMillis"]),o=function(f){if(Object.prototype.hasOwnProperty.call(e,f)){var p=t[f],h=d(e[f]);if(!(f==="transport"&&!s.validateTransport(p))){if(f==="sessionId"&&p!==null){e[f]=s.validateSessionId(p)?p:null;return}else if(!s.validateInput(p,f+" option",h))return;h==="boolean"?e[f]=!!p:h==="string"&&!s.isEmptyString(p)||h==="number"&&(p>0||p===0&&i.has(f))||h==="function"?e[f]=p:h==="object"&&n(e[f],p)}}};for(var a in t)r.has(a)?e[a]=N(N({},e[a]),t[a]):Object.prototype.hasOwnProperty.call(t,a)&&o(a)}};c.prototype.runQueuedFunctions=function(){var n=this._q;this._q=[];for(var e=0;e<n.length;e++){var t=this[n[e][0]];d(t)==="function"&&t.apply(this,n[e].slice(1))}};c.prototype._apiKeySet=function(e){return s.isEmptyString(this.options.apiKey)?(s.log.error("Invalid apiKey. Please set a valid apiKey with init() before calling "+e),!1):!0};c.prototype._loadSavedUnsentEvents=function(e){var t=this._getFromStorage(P,e),r=this._parseSavedUnsentEventsString(t,e);return this._setInStorage(P,e,JSON.stringify(r)),r};c.prototype._parseSavedUnsentEventsString=function(e,t){if(s.isEmptyString(e))return[];if(d(e)==="string")try{var r=JSON.parse(e);if(d(r)==="array")return r}catch{}return s.log.error("Unable to load "+t+" events. Restart with a new empty queue."),[]};c.prototype.isNewSession=function(){return this._newSession};c.prototype.onInit=function(e){this._isInitialized?e(this):this._onInitCallbacks.push(e)};c.prototype.onNewSessionStart=function(e){this._onNewSessionStartCallbacks.push(e)};c.prototype.getSessionId=function(){return this._sessionId};c.prototype.nextEventId=function(){return this._eventId++,this._eventId};c.prototype.nextIdentifyId=function(){return this._identifyId++,this._identifyId};c.prototype.nextSequenceNumber=function(){return this._sequenceNumber++,this._sequenceNumber};c.prototype._unsentCount=function(){return this._unsentEvents.length+this._unsentIdentifys.length};c.prototype._sendEventsIfReady=function(){return this._unsentCount()===0?!1:this.options.batchEvents?this._unsentCount()>=this.options.eventUploadThreshold?(this.sendEvents(),!0):this.options.transport===l.TRANSPORT_BEACON?(this.sendEvents(),!0):(this._updateScheduled||(this._updateScheduled=!0,setTimeout((function(){this._updateScheduled=!1,this.sendEvents()}).bind(this),this.options.eventUploadPeriodMillis)),!1):(this.sendEvents(),!0)};c.prototype.clearStorage=function(){return this._metadataStorage.clear()};c.prototype._getFromStorage=function(e,t){return e.getItem(t+this._storageSuffix)};c.prototype._setInStorage=function(e,t,r){e.setItem(t+this._storageSuffix,r)};var le=function(e){if(!e._useOldCookie){var t=e._metadataStorage.load();d(t)==="object"&&oe(e,t);return}var r=e.cookieStorage.get(e._oldCookiename);if(d(r)==="object"){oe(e,r);return}},qt=function(e){var t=e.cookieStorage.get(e._oldCookiename);d(t)==="object"&&(oe(e,t),U(e))},oe=function(e,t){t.deviceId&&(e.options.deviceId=t.deviceId),t.userId&&(e.options.userId=t.userId),t.optOut!==null&&t.optOut!==void 0&&t.optOut!==!1&&(e.options.optOut=t.optOut),t.sessionId&&(e._sessionId=parseInt(t.sessionId,10)),t.lastEventTime&&(e._lastEventTime=parseInt(t.lastEventTime,10)),t.eventId&&(e._eventId=parseInt(t.eventId,10)),t.identifyId&&(e._identifyId=parseInt(t.identifyId,10)),t.sequenceNumber&&(e._sequenceNumber=parseInt(t.sequenceNumber,10))},U=function(e){var t={deviceId:e.options.deviceId,userId:e.options.userId,optOut:e.options.optOut,sessionId:e._sessionId,lastEventTime:e._lastEventTime,eventId:e._eventId,identifyId:e._identifyId,sequenceNumber:e._sequenceNumber};e._useOldCookie?e.cookieStorage.set(e.options.cookieName+e._storageSuffix,t):e._metadataStorage.save(t)};c.prototype._initUtmData=function(e,t){e=e||this._getUrlParams(),t=t||this.cookieStorage.get("__utmz");var r=yt(t,e);return $(this,r),r};c.prototype._unsetUTMParams=function(){var e=new E;e.unset(l.REFERRER),e.unset(l.REFERRING_DOMAIN),e.unset(l.UTM_SOURCE),e.unset(l.UTM_MEDIUM),e.unset(l.UTM_CAMPAIGN),e.unset(l.UTM_TERM),e.unset(l.UTM_CONTENT),this.identify(e)};var $=function(e,t){if(!(d(t)!=="object"||Object.keys(t).length===0)){var r=new E;for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r.setOnce("initial_"+i,t[i]),r.set(i,t[i]));e.identify(r)}};c.prototype._getReferrer=function(){var e=this._getReferrerFromUrlParam(this._getUrlParams());return e||(typeof document<"u"?document.referrer:"")};c.prototype._getUrlParams=function(){return v.location.search};c.prototype._saveGclid=function(e){var t=s.getQueryParam("gclid",e);if(!s.isEmptyString(t)){var r={gclid:t};return $(this,r),r}};c.prototype._saveFbclid=function(e){var t=s.getQueryParam("fbclid",e);if(!s.isEmptyString(t)){var r={fbclid:t};return $(this,r),r}};c.prototype._getDeviceIdFromUrlParam=function(e){return s.getQueryParam(l.AMP_DEVICE_ID_PARAM,e)};c.prototype._getReferrerFromUrlParam=function(e){return s.getQueryParam(l.AMP_REFERRER_PARAM,e)};c.prototype._getReferringDomain=function(e){if(s.isEmptyString(e))return null;var t=e.split("/");return t.length>=3?t[2]:null};c.prototype._saveReferrer=function(e){if(!s.isEmptyString(e)){var t={referrer:e,referring_domain:this._getReferringDomain(e)};return $(this,t),t}};c.prototype.saveEvents=function(){try{var e=JSON.stringify(this._unsentEvents.map(function(r){var i=r.event;return i}));this._setInStorage(P,this.options.unsentKey,e)}catch{}try{var t=JSON.stringify(this._unsentIdentifys.map(function(r){return r.event}));this._setInStorage(P,this.options.unsentIdentifyKey,t)}catch{}};c.prototype.setDomain=function(e){if(this._shouldDeferCall())return this._q.push(["setDomain"].concat(Array.prototype.slice.call(arguments,0)));if(s.validateInput(e,"domain","string"))try{this.cookieStorage.options({expirationDays:this.options.cookieExpiration,secure:this.options.secureCookie,domain:e,sameSite:this.options.sameSiteCookie}),this.options.domain=this.cookieStorage.options().domain,le(this),U(this)}catch(t){s.log.error(t)}};c.prototype.setUserId=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(s.validateInput(t,"startNewSession","boolean")){if(this._shouldDeferCall())return this._q.push(["setUserId"].concat(Array.prototype.slice.call(arguments,0)));try{this.options.userId=e!=null&&""+e||null,t&&(this.options.unsetParamsReferrerOnNewSession&&this._unsetUTMParams(),this._newSession=!0,this._sessionId=new Date().getTime(),this._runNewSessionStartCallbacks(),this.options.saveParamsReferrerOncePerSession&&this._trackParamsAndReferrer()),U(this),this._connector&&this._connector.identityStore.editIdentity().setUserId(this.options.userId).commit()}catch(r){s.log.error(r)}}};c.prototype.setGroup=function(n,e){if(this._shouldDeferCall())return this._q.push(["setGroup"].concat(Array.prototype.slice.call(arguments,0)));if(!(!this._apiKeySet("setGroup()")||!s.validateInput(n,"groupType","string")||s.isEmptyString(n))){var t={};t[n]=e;var r=new E().set(n,e);this._logEvent(l.IDENTIFY_EVENT,null,null,r.userPropertiesOperations,t,null,null,null)}};c.prototype.setOptOut=function(e){if(this._shouldDeferCall())return this._q.push(["setOptOut"].concat(Array.prototype.slice.call(arguments,0)));if(s.validateInput(e,"enable","boolean"))try{this.options.optOut=e,U(this)}catch(t){s.log.error(t)}};c.prototype.setSessionId=function(e){if(s.validateInput(e,"sessionId","number"))try{this._sessionId=e,U(this)}catch(t){s.log.error(t)}};c.prototype.resetSessionId=function(){this.setSessionId(new Date().getTime())};c.prototype.regenerateDeviceId=function(){if(this._shouldDeferCall())return this._q.push(["regenerateDeviceId"].concat(Array.prototype.slice.call(arguments,0)));this.setDeviceId(ue())};c.prototype.setDeviceId=function(e){if(this._shouldDeferCall())return this._q.push(["setDeviceId"].concat(Array.prototype.slice.call(arguments,0)));if(s.validateDeviceId(e))try{s.isEmptyString(e)||(this.options.deviceId=""+e,U(this),this._connector&&this._connector.identityStore.editIdentity().setDeviceId(this.options.deviceId).commit())}catch(t){s.log.error(t)}};c.prototype.setTransport=function(e){if(this._shouldDeferCall())return this._q.push(["setTransport"].concat(Array.prototype.slice.call(arguments,0)));s.validateTransport(e)&&(this.options.transport=e)};c.prototype.setUserProperties=function(e){if(this._shouldDeferCall())return this._q.push(["setUserProperties"].concat(Array.prototype.slice.call(arguments,0)));if(!(!this._apiKeySet("setUserProperties()")||!s.validateInput(e,"userProperties","object"))){var t=s.truncate(s.validateProperties(e));if(Object.keys(t).length!==0){var r=new E;for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&r.set(i,t[i]);this.identify(r)}}};c.prototype.clearUserProperties=function(){if(this._shouldDeferCall())return this._q.push(["clearUserProperties"].concat(Array.prototype.slice.call(arguments,0)));if(this._apiKeySet("clearUserProperties()")){var e=new E;e.clearAll(),this.identify(e)}};var ce=function(e,t){for(var r=0;r<t._q.length;r++){var i=e[t._q[r][0]];d(i)==="function"&&i.apply(e,t._q[r].slice(1))}return e};c.prototype.identify=function(n,e,t,r){if(this._shouldDeferCall())return this._q.push(["identify"].concat(Array.prototype.slice.call(arguments,0)));if(!this._apiKeySet("identify()")){S(e,t,0,"No request sent",{reason:"API key is not set"});return}if(d(n)==="object"&&Object.prototype.hasOwnProperty.call(n,"_q")&&(n=ce(new E,n)),n instanceof E){if(Object.keys(n.userPropertiesOperations).length>0)return this._logEvent(l.IDENTIFY_EVENT,null,null,n.userPropertiesOperations,null,null,null,e,t,r);S(e,t,0,"No request sent",{reason:"No user property operations"})}else s.log.error("Invalid identify input type. Expected Identify object but saw "+d(n)),S(e,t,0,"No request sent",{reason:"Invalid identify input type"})};c.prototype.groupIdentify=function(n,e,t,r,i,o){if(this._shouldDeferCall())return this._q.push(["groupIdentify"].concat(Array.prototype.slice.call(arguments,0)));if(!this._apiKeySet("groupIdentify()")){S(r,i,0,"No request sent",{reason:"API key is not set"});return}if(!s.validateInput(n,"group_type","string")||s.isEmptyString(n)){S(r,i,0,"No request sent",{reason:"Invalid group type"});return}if(e==null){S(r,i,0,"No request sent",{reason:"Invalid group name"});return}if(d(t)==="object"&&Object.prototype.hasOwnProperty.call(t,"_q")&&(t=ce(new E,t)),t instanceof E){if(Object.keys(t.userPropertiesOperations).length>0)return this._logEvent(l.GROUP_IDENTIFY_EVENT,null,null,null,F({},n,e),t.userPropertiesOperations,null,r,i,o);S(r,i,0,"No request sent",{reason:"No group property operations"})}else s.log.error("Invalid identify input type. Expected Identify object but saw "+d(t)),S(r,i,0,"No request sent",{reason:"Invalid identify input type"})};c.prototype.setVersionName=function(e){if(this._shouldDeferCall())return this._q.push(["setVersionName"].concat(Array.prototype.slice.call(arguments,0)));s.validateInput(e,"versionName","string")&&(this.options.versionName=e)};c.prototype._logEvent=function(e,t,r,i,o,a,u,f,p,h){if(le(this),!e){S(f,p,0,"No request sent",{reason:"Missing eventType"});return}if(this.options.optOut){S(f,p,0,"No request sent",{reason:"optOut is set to true"});return}try{var g;e===l.IDENTIFY_EVENT||e===l.GROUP_IDENTIFY_EVENT?g=this.nextIdentifyId():g=this.nextEventId();var w=this.nextSequenceNumber(),T=d(u)==="number"?u:new Date().getTime();h?this._sessionId=-1:(!this._sessionId||!this._lastEventTime||T-this._lastEventTime>this.options.sessionTimeout)&&(this._sessionId=T,this._runNewSessionStartCallbacks()),this._lastEventTime=T,U(this);var _=this._ua.browser.name,A=this._ua.browser.major,M=this._ua.device.model||this._ua.os.name,B=this._ua.device.vendor;i=i||{};var j=N({},this._apiPropertiesTrackingOptions);r=N(N({},r||{}),j),t=t||{},o=o||{},a=a||{};var X={device_id:this.options.deviceId,user_id:this.options.userId,timestamp:T,event_id:g,session_id:this._sessionId||-1,event_type:e,version_name:this.options.versionName||null,platform:q(this,"platform")?this.options.platform:null,os_name:q(this,"os_name")&&_||null,os_version:q(this,"os_version")&&A||null,device_model:q(this,"device_model")&&M||null,device_manufacturer:q(this,"device_manufacturer")&&B||null,language:q(this,"language")?this.options.language:null,api_properties:r,event_properties:s.truncate(s.validateProperties(t)),user_properties:s.truncate(s.validateProperties(i)),uuid:Dt(),library:this.options.library,sequence_number:w,groups:s.truncate(s.validateGroups(o)),group_properties:s.truncate(s.validateProperties(a)),user_agent:this._userAgent,partner_id:this.options.partnerId||null};return Vt(this)&&(X.plan={branch:this.options.plan.branch||void 0,source:this.options.plan.source||void 0,version:this.options.plan.version||void 0,versionId:this.options.plan.versionId||void 0}),xt(this)&&(X.ingestion_metadata={source_name:this.options.ingestionMetadata.sourceName||void 0,source_version:this.options.ingestionMetadata.sourceVersion||void 0}),e===l.IDENTIFY_EVENT||e===l.GROUP_IDENTIFY_EVENT?(this._unsentIdentifys.push({event:X,callback:f,errorCallback:p}),this._limitEventsQueued(this._unsentIdentifys)):(this._unsentEvents.push({event:X,callback:f,errorCallback:p}),this._limitEventsQueued(this._unsentEvents)),this.options.saveEvents&&this.saveEvents(),this._sendEventsIfReady(),e===l.IDENTIFY_EVENT&&this._connector&&this._connector.identityStore.editIdentity().updateUserProperties(s.truncate(s.validateProperties(i))).commit(),g}catch(Ce){s.log.error(Ce)}};var Vt=function(e){return e.options.plan&&(e.options.plan.source||e.options.plan.branch||e.options.plan.version||e.options.plan.versionId)},xt=function(e){return e.options.ingestionMetadata&&(e.options.ingestionMetadata.sourceName||e.options.ingestionMetadata.sourceVersion)},q=function(e,t){return!!e.options.trackingOptions[t]},Gt=function(e){for(var t=["city","country","dma","ip_address","region"],r={},i=0;i<t.length;i++){var o=t[i];q(e,o)||(r[o]=!1)}return r};c.prototype._limitEventsQueued=function(e){if(e.length>this.options.savedMaxCount){var t=e.splice(0,e.length-this.options.savedMaxCount);t.forEach(function(r){S(r.callback,r.errorCallback,0,"No request sent",{reason:"Event dropped because options.savedMaxCount exceeded. User may be offline or have a content blocker"})})}};c.prototype.logEvent=function(e,t,r,i){var o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return this._shouldDeferCall()?this._q.push(["logEvent"].concat(Array.prototype.slice.call(arguments,0))):this.logEventWithTimestamp(e,t,null,r,i,o)};c.prototype.logEventWithTimestamp=function(e,t,r,i,o){var a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;return this._shouldDeferCall()?this._q.push(["logEventWithTimestamp"].concat(Array.prototype.slice.call(arguments,0))):this._apiKeySet("logEvent()")?s.validateInput(e,"eventType","string")?s.isEmptyString(e)?(S(i,o,0,"No request sent",{reason:"Missing eventType"}),-1):(s.validateInput(a,"outOfSession","boolean")||S(i,o,0,"No request sent",{reason:"Invalid outOfSession value"}),this._logEvent(e,t,null,null,null,null,r,i,o,a)):(S(i,o,0,"No request sent",{reason:"Invalid type for eventType"}),-1):(S(i,o,0,"No request sent",{reason:"API key not set"}),-1)};c.prototype.logEventWithGroups=function(n,e,t,r,i){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;return this._shouldDeferCall()?this._q.push(["logEventWithGroups"].concat(Array.prototype.slice.call(arguments,0))):this._apiKeySet("logEventWithGroups()")?s.validateInput(n,"eventType","string")?(s.validateInput(o,"outOfSession","boolean")||S(event.callback,event.errorCallback,0,"No request sent",{reason:"Invalid outOfSession value"}),this._logEvent(n,e,null,null,t,null,null,r,i,o)):(S(event.callback,event.errorCallback,0,"No request sent",{reason:"Invalid type for eventType"}),-1):(S(event.callback,event.errorCallback,0,"No request sent",{reason:"API key not set"}),-1)};var ve=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},S=function(e,t,r,i,o){d(e)==="function"&&e(r,i,o),d(t)==="function"&&t(r,i,o)};c.prototype.logRevenueV2=function(e){if(this._shouldDeferCall())return this._q.push(["logRevenueV2"].concat(Array.prototype.slice.call(arguments,0)));if(this._apiKeySet("logRevenueV2()"))if(d(e)==="object"&&Object.prototype.hasOwnProperty.call(e,"_q")&&(e=ce(new C,e)),e instanceof C){if(e&&e._isValidRevenue())return this.logEvent(l.REVENUE_EVENT,e._toJSONObject())}else s.log.error("Invalid revenue input type. Expected Revenue object but saw "+d(e))};c.prototype.logRevenue=function(e,t,r){return this._shouldDeferCall()?this._q.push(["logRevenue"].concat(Array.prototype.slice.call(arguments,0))):!this._apiKeySet("logRevenue()")||!ve(e)||t!==void 0&&!ve(t)?-1:this._logEvent(l.REVENUE_EVENT,{},{productId:r,special:"revenue_amount",quantity:t||1,price:e},null,null,null,null,null)};c.prototype._logErrorsOnEvents=function(e,t,r,i){for(var o=["_unsentEvents","_unsentIdentifys"],a=0;a<o.length;a++)for(var u=o[a],f=u==="_unsentEvents"?e:t,p=0;p<this[u].length;p++){var h=this[u][p];h.event.event_id<=f&&h.errorCallback&&h.errorCallback(r,i)}};c.prototype.removeEvents=function(e,t,r,i){ge(this,"_unsentEvents",e,r,i),ge(this,"_unsentIdentifys",t,r,i)};var ge=function(e,t,r,i,o){if(!(r<0)){for(var a=[],u=0;u<e[t].length;u++){var f=e[t][u];f.event.event_id>r?a.push(f):f.callback&&f.callback(i,o)}e[t]=a}};c.prototype.sendEvents=function(){if(!this._apiKeySet("sendEvents()")){this.removeEvents(1/0,1/0,0,"No request sent",{reason:"API key not set"});return}if(this.options.optOut){this.removeEvents(1/0,1/0,0,"No request sent",{reason:"Opt out is set to true"});return}if(this._unsentCount()!==0){if(this.options.transport!==l.TRANSPORT_BEACON){if(this._sending)return;this._sending=!0}var e=this.options.forceHttps||v.location.protocol==="https:"?"https":"http",t=e+"://"+this.options.apiEndpoint,r=Math.min(this._unsentCount(),this.options.uploadBatchSize),i=this._mergeEventsAndIdentifys(r),o=i.maxEventId,a=i.maxIdentifyId,u=JSON.stringify(i.eventsToSend.map(function(_){var A=_.event;return A})),f=new Date().getTime(),p={client:this.options.apiKey,e:u,v:l.API_VERSION,upload_time:f,checksum:Me(l.API_VERSION+this.options.apiKey+u+f)};if(this.options.transport===l.TRANSPORT_BEACON&&typeof navigator<"u"){var h=navigator.sendBeacon(t,new URLSearchParams(p));h?(this.removeEvents(o,a,200,"success"),this.options.saveEvents&&this.saveEvents()):this._logErrorsOnEvents(o,a,0,"");return}var g=this;try{new be(t,p,this.options.headers).send(function(_,A){g._sending=!1;try{_===200?(g.removeEvents(o,a,_,A),g.options.saveEvents&&g.saveEvents(),g._sendEventsIfReady()):(g._logErrorsOnEvents(o,a,_,A),_===413&&(g.options.uploadBatchSize===1&&g.removeEvents(o,a,_,A),g.options.uploadBatchSize=Math.ceil(r/2),g.sendEvents()))}catch{}})}catch(_){var w=0,T="Request failed to send";s.log.error(T),g._logErrorsOnEvents(o,a,w,T),g.removeEvents(o,a,w,T,{reason:_.message})}}};c.prototype._mergeEventsAndIdentifys=function(e){for(var t=[],r=0,i=-1,o=0,a=-1;t.length<e;){var u=void 0,f=o>=this._unsentIdentifys.length,p=r>=this._unsentEvents.length;if(p&&f){s.log.error("Merging Events and Identifys, less events and identifys than expected");break}else f?(u=this._unsentEvents[r++],i=u.event.event_id):p?(u=this._unsentIdentifys[o++],a=u.event.event_id):!("sequence_number"in this._unsentEvents[r].event)||this._unsentEvents[r].event.sequence_number<this._unsentIdentifys[o].event.sequence_number?(u=this._unsentEvents[r++],i=u.event.event_id):(u=this._unsentIdentifys[o++],a=u.event.event_id);t.push(u)}return{eventsToSend:t,maxEventId:i,maxIdentifyId:a}};c.prototype.setGlobalUserProperties=function(e){this.setUserProperties(e)};c.prototype.__VERSION__=function(){return this.options.library.version};c.prototype.setLibrary=function(e,t){e!==null&&typeof e<"u"&&(this.options.library.name=e),t!==null&&typeof t<"u"&&(this.options.library.version=t)};c.prototype._shouldDeferCall=function(){return this._pendingReadStorage||this._initializationDeferred};c.prototype._deferInitialization=function(){this._initializationDeferred=!0,this._q.push(["init"].concat(Array.prototype.slice.call(arguments,0)))};c.prototype.enableTracking=function(){this._initializationDeferred=!1,U(this),this.runQueuedFunctions()};c.prototype._refreshDynamicConfig=function(){this.options.useDynamicConfig&&de.refresh(this.options.serverZone,this.options.forceHttps,(function(){this.options.apiEndpoint=de.ingestionEndpoint}).bind(this))};c.prototype.getDeviceId=function(){return this.options.deviceId};c.prototype.getUserId=function(){return this.options.userId};c.prototype.setMinTimeBetweenSessionsMillis=function(e){if(s.validateInput(e,"timeInMillis","number")){if(this._shouldDeferCall())return this._q.push(["setMinTimeBetweenSessionsMillis"].concat(Array.prototype.slice.call(arguments,0)));try{this.options.sessionTimeout=e}catch(t){s.log.error(t)}}};c.prototype.setEventUploadThreshold=function(e){if(s.validateInput(e,"eventUploadThreshold","number")){if(this._shouldDeferCall())return this._q.push(["setEventUploadThreshold"].concat(Array.prototype.slice.call(arguments,0)));try{this.options.eventUploadThreshold=e}catch(t){s.log.error(t)}}};c.prototype.setUseDynamicConfig=function(e){if(s.validateInput(e,"useDynamicConfig","boolean")){if(this._shouldDeferCall())return this._q.push(["setUseDynamicConfig"].concat(Array.prototype.slice.call(arguments,0)));try{this.options.useDynamicConfig=e,this._refreshDynamicConfig()}catch(t){s.log.error(t)}}};c.prototype.setServerZone=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(e!==x.EU&&e!==x.US||!s.validateInput(t,"serverZoneBasedApi","boolean"))){if(this._shouldDeferCall())return this._q.push(["setServerZone"].concat(Array.prototype.slice.call(arguments,0)));try{this.options.serverZone=e,this.options.serverZoneBasedApi=t,t&&(this.options.apiEndpoint=Re(this.options.serverZone))}catch(r){s.log.error(r)}}};c.prototype.setServerUrl=function(e){if(s.validateInput(e,"serverUrl","string")){if(this._shouldDeferCall())return this._q.push(["setServerUrl"].concat(Array.prototype.slice.call(arguments,0)));try{this.options.apiEndpoint=e}catch(t){s.log.error(t)}}};var m=function(){this.options=N({},L),this._q=[],this._instances={}};m.prototype.Identify=E;m.prototype.Revenue=C;m.prototype.getInstance=function(e){e=s.isEmptyString(e)?l.DEFAULT_INSTANCE:e.toLowerCase();var t=this._instances[e];return t===void 0&&(t=new c(e),this._instances[e]=t),t};m.prototype.init=function(e,t,r,i){this.getInstance().init(e,t,r,(function(o){this.options=o.options,d(i)==="function"&&i(o)}).bind(this))},m.prototype.isNewSession=function(){return this.getInstance().isNewSession()},m.prototype.getSessionId=function(){return this.getInstance().getSessionId()},m.prototype.nextEventId=function(){return this.getInstance().nextEventId()},m.prototype.nextIdentifyId=function(){return this.getInstance().nextIdentifyId()},m.prototype.nextSequenceNumber=function(){return this.getInstance().nextSequenceNumber()},m.prototype.saveEvents=function(){this.getInstance().saveEvents()},m.prototype.setDomain=function(e){this.getInstance().setDomain(e)},m.prototype.setUserId=function(e){this.getInstance().setUserId(e)},m.prototype.setGroup=function(n,e){this.getInstance().setGroup(n,e)},m.prototype.setOptOut=function(e){this.getInstance().setOptOut(e)},m.prototype.regenerateDeviceId=function(){this.getInstance().regenerateDeviceId()},m.prototype.setDeviceId=function(e){this.getInstance().setDeviceId(e)},m.prototype.setUserProperties=function(e){this.getInstance().setUserProperties(e)},m.prototype.clearUserProperties=function(){this.getInstance().clearUserProperties()},m.prototype.identify=function(n,e){this.getInstance().identify(n,e)},m.prototype.setVersionName=function(e){this.getInstance().setVersionName(e)},m.prototype.logEvent=function(e,t,r){return this.getInstance().logEvent(e,t,r)},m.prototype.logEventWithGroups=function(n,e,t,r){return this.getInstance().logEventWithGroups(n,e,t,r)},m.prototype.logRevenueV2=function(e){return this.getInstance().logRevenueV2(e)},m.prototype.logRevenue=function(e,t,r){return this.getInstance().logRevenue(e,t,r)},m.prototype.removeEvents=function(e,t){this.getInstance().removeEvents(e,t)},m.prototype.sendEvents=function(e){this.getInstance().sendEvents(e)},m.prototype.setGlobalUserProperties=function(e){this.getInstance().setUserProperties(e)};m.prototype.__VERSION__=Ae;var H=typeof v<"u"&&v.amplitude||{},Pe=new m;Pe._q=H._q||[];for(var J in H._iq)Object.prototype.hasOwnProperty.call(H._iq,J)&&(Pe.getInstance(J)._q=H._iq[J]._q||[]);export{Pe as n};
//# sourceMappingURL=amplitude-js-Dr22cH67.js.map
